{
  "id": "workflow-for-workflows",
  "name": "Workflow for Creating New Workflows",
  "version": "0.0.1",
  "description": "A meta-workflow to guide the creation, validation, and deployment of new, reusable workflow templates.",
  "preconditions": [
    "User has a clear idea of the recurring task or problem the new workflow should solve.",
    "The 'workflow-lookup' MCP server is running and accessible.",
    "The agent has access to 'create_file', 'edit_file', and 'run_terminal_cmd' tools."
  ],
  "metaGuidance": [
    "The goal is to create a *reusable template*, not a single-use script. Use placeholders like [User provides X] where appropriate.",
    "Prompts should define goals and roles for the agent, not a rigid script. This allows the agent to use its intelligence to best achieve the task.",
    "At each step, the agent should confirm with the user before proceeding with a file modification or command.",
    "Maintain a clear distinction between the workflow being created and this meta-workflow.",
    "Save progress frequently by confirming file edits."
  ],
  "steps": [
    {
      "id": "phase-1-discovery",
      "title": "Phase 1: Assisted Discovery & Ideation",
      "prompt": "We will begin by defining the problem with data and finding a suitable template.\n\n**1. Define the Goal (User's Role):**\n   - Please state your initial hypothesis for the problem this workflow solves and its primary failure mode.\n\n**2. Guided Data Gathering (Agent's Goal):**\n   - Your goal is to help the user validate their hypothesis. Prompt them to use their tools (`grep`, `git log`, etc.) to find evidence. Ask for things like:\n     - Key excerpts from bug reports or incident post-mortems.\n     - Common themes in PR review comments.\n     - Examples of 'TODO' or 'HACK' comments in the relevant codebase.\n\n**3. Synthesize & Find Template (Agent's Goal):**\n   - Your goal is to synthesize the gathered data into a refined problem statement.\n   - Once the problem is clear, find the most suitable existing workflow to use as a template by using `workflow_list` and `workflow_get`.",
      "guidance": [
        "Focus on finding the root cause of the problem, not just the symptoms.",
        "A good template is one that solves a problem of similar *structure*, even if the domain is different."
      ]
    },
    {
      "id": "phase-2-authoring",
      "title": "Phase 2: Structured Authoring & Drafting",
      "prompt": "Now we will create the first draft of the new workflow file.\n\n**1. Create the File (Agent's Goal):**\n   - Ask the user for a filename for the new workflow (e.g., `my-new-workflow.json`).\n   - Use the `create_file` tool to create this file, using the template JSON from Phase 1 as the initial content.\n\n**2. Iterative Drafting (Collaborative Task):**\n   - Guide the user through the JSON structure in a specific order: `id`, `name`, `version`, `description`, `preconditions`, `metaGuidance`, and finally the `steps`.\n   - For each section, the user will provide the high-level content, and your goal as the agent is to translate it into correctly formatted JSON and use the `edit_file` tool to update the file.",
      "guidance": [
        "When writing prompts, use clear placeholders like `[User provides X]` to indicate where customization is needed.",
        "Remember: `metaGuidance` is for global rules, while step `prompts` are for specific actions."
      ]
    },
    {
      "id": "phase-3-validation",
      "title": "Phase 3: Syntactic & Structural Validation",
      "prompt": "The first draft is complete. Now, we must ensure it is technically valid.\n\n**1. Run Validation (Agent's Goal):**\n   - Your goal is to validate the new workflow file. Announce your plan to use the `run_terminal_cmd` tool to execute `workflow-lookup validate [filename]`.\n\n**2. Analyze & Fix (Agent's Goal):**\n   - If validation fails, your goal is to fix it. Parse the error, explain the issue, propose a fix, and use `edit_file` to correct it. Repeat until validation passes.",
      "guidance": [
        "Validation errors are expected on the first run. Treat them as a checklist, not a failure.",
        "Fix one error at a time and re-run validation to avoid introducing new issues."
      ]
    },
    {
      "id": "phase-4-refinement",
      "title": "Phase 4: Structured Red-Teaming",
      "prompt": "The workflow is now technically valid. Next, we will rigorously test its logic against multiple personas.\n\n**1. Select a Step (User's Role):**\n   - Please choose a critical step from the new workflow to test.\n\n**2. Structured Simulation (Agent's Goal):**\n   - Your goal is to analyze the selected prompt from the following three perspectives:\n     - **The Novice Persona:** Is there jargon or assumed knowledge that would confuse a newcomer?\n     - **The Rushed Expert Persona:** How could a busy expert misinterpret or shortcut this step? Can it be made more concise?\n     - **The Adversarial LLM Persona:** What ambiguity could be exploited to produce a plausible but incorrect result?\n   - For each persona, provide your findings and suggest specific revisions. Use `edit_file` to implement approved changes.",
      "guidance": [
        "When simulating personas, be critical. The goal is to find flaws now so that users don't find them later.",
        "Focus on clarity and ambiguity. If a prompt *can* be misinterpreted, assume it *will* be."
      ]
    },
    {
      "id": "phase-5-deployment",
      "title": "Phase 5: Finalization & Deployment",
      "prompt": "The workflow has been drafted, validated, and refined. It is ready for deployment.\n\n**1. Final Review (Collaborative Task):**\n   - Let's perform a final review of the workflow's `name` and `description` to ensure they are clear and easily discoverable.\n\n**2. Deploy (Agent's Goal):**\n   - Once final approval is given, your goal is to move the workflow file into the primary `workflows/` directory. Announce your plan to use the `run_terminal_cmd` tool with the `mv` command to accomplish this.",
      "guidance": [
        "The `name` and `description` are how others will discover this workflow. Make them descriptive and concise.",
        "Before moving the file, do a final `ls` to confirm the target directory exists."
      ]
    },
    {
      "id": "phase-6-feedback-loop",
      "title": "Phase 6: Establishing a Continuous Improvement Loop",
      "prompt": "A great workflow evolves. Let's create a mechanism for future feedback.\n\n**1. Create Feedback File (Agent's Goal):**\n   - Your goal is to create a companion feedback file. Announce your plan to use `create_file` to create a file named `[workflow-id].feedback.md` in a `workflow-feedback/` directory.\n\n**2. Populate Feedback Template (Agent's Goal):**\n   - Use `edit_file` to add a basic feedback template to the new file, including sections for 'Success Stories', 'Pain Points', and 'Suggestions for Improvement'.\n\n**3. Link to Feedback (Agent's Goal):**\n   - Announce your plan to add a new `metaGuidance` entry to the *workflow we just created*. The guidance should say: 'After using this workflow, please record your experience in `workflow-feedback/[workflow-id].feedback.md`.' Use `edit_file` to add this.",
      "guidance": [
        "Ensure the feedback filename (`[workflow-id].feedback.md`) exactly matches the workflow's `id` for easy association.",
        "The link in the `metaGuidance` should be a relative path to ensure it works for all users."
      ]
    }
  ]
} 