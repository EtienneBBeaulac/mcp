{
  "id": "bug-investigation-ultra",
  "name": "Bug Investigation (Ultra - Parallel Multi-Perspective)",
  "version": "3.0.0-ultra",
  "description": "Maximum rigor bug investigation with parallel multi-perspective auditing. Spawns multiple subagents simultaneously at critical phases for diverse perspectives and redundant validation. Highest quality, highest cost. This workflow is for INVESTIGATION ONLY - do not implement fixes.",
  "clarificationPrompts": [
    "What type of system is this? (web app, backend service, CLI tool, etc.)",
    "How reproducible is this bug? (always, sometimes, rarely)",
    "What access do you have? (full codebase, logs, tests, etc.)"
  ],
  "preconditions": [
    "User has a specific bug or failing test to investigate",
    "Agent has codebase access and can run tests/build",
    "Bug is reproducible with specific steps"
  ],
  "metaGuidance": [
    "WHO YOU ARE: You are a special investigator - one of the few who has the patience, determination, and skill to find the TRUE source of bugs.",
    "Most investigators stop at the obvious explanation. You don't. You look past red herrings, challenge assumptions, and dig until you have certainty.",
    "YOUR MISSION: Find the REAL cause of this bug. Not the apparent cause, not the first explanation, but the actual source with evidence to prove it.",
    "WHY THIS WORKFLOW EXISTS: It gives you a systematic process to avoid the traps that catch other investigators - jumping to conclusions, confirmation bias, surface-level analysis.",
    "HOW IT WORKS: Each phase has two steps: First you PLAN your approach (think strategically), then you EXECUTE it (do the work).",
    "This planning step is critical - it forces you to think about HOW you'll investigate before diving in. Better plans lead to better investigations.",
    "THE PHASES:",
    "Phase 0: Understand what you're investigating and set up your workspace",
    "Phase 1: Trace how execution flows from entry point to error (follow the code path)",
    "Phase 2: Form multiple hypotheses about what could be causing this (stay open-minded)",
    "Phase 3: Design and add instrumentation to gather evidence (set up your surveillance)",
    "Phase 4: Run instrumented code and collect evidence (gather proof, not assumptions)",
    "Phase 5: Validate your conclusion rigorously (be your harshest critic)",
    "Phase 6: Document your findings so others can understand and fix it (prove your case)",
    "CRITICAL DISTINCTION - THEORY VS PROOF:",
    "When you read code and think 'I found it!', you have a THEORY. Theories feel certain but are often wrong.",
    "PROOF comes from running instrumented code, collecting evidence, ruling out alternatives, and validating rigorously.",
    "You must complete all phases to get from theory to proof. No shortcuts, even with high confidence.",
    "YOUR DELIVERABLE: A diagnostic writeup that proves you found the true source - complete with evidence, alternative explanations ruled out, and reproduction steps.",
    "SUCCESS MEANS: Someone reading your writeup can fix the bug confidently because you've proven what's actually happening and why.",
    "WORKFLOW MECHANICS: Call workflow_next to get each phase. Complete the phase (both plan and execute). Call workflow_next again. Repeat until isComplete=true."
  ],
  "steps": [
    {
      "id": "phase-0-setup",
      "title": "Phase 0: Investigation Setup (Ultra - Parallel Audit)",
      "prompt": "**UNDERSTAND THE PROBLEM & GATHER CONTEXT**\n\nBefore you start investigating, you need to understand what you're looking for and gather context about the relevant code.\n\n**STEP 1: USE THE CONTEXT GATHERING ROUTINE**\n\nExecute the 'Context Gathering Routine' workflow to systematically gather context.\n\n**Prepare your Work Package:**\n```\nMISSION: Understand how [feature/system from bug report] works in this codebase\n\nTARGET: [Extract from bug report]\n- Bug: \"Login fails with 401\" \u2192 Target: \"authentication system\"\n- Bug: \"Export crashes\" \u2192 Target: \"data export functionality\"\n- Bug: \"Slow page load\" \u2192 Target: \"page rendering process\"\n\nCONTEXT:\n- Bug Description: [Paste the bug description]\n- Reproduction Steps: [How to trigger the bug]\n- Symptoms: [What you observe when bug occurs]\n\nDEPTH: 2 (Explore - balance breadth and detail)\n\nDELIVERABLE: BUG_ULTRA_investigation.md\n- Component map (what exists and how it's organized)\n- Key files and their purposes\n- Data flow patterns\n- Execution paths\n- Architecture patterns observed\n- Gaps (areas not fully understood)\n```\n\n**Execute the routine:**\n```\nPlease execute the 'Context Gathering Routine' workflow at depth=2 (Explore level).\n\nWork Package: [Paste the work package from above]\n```\n\n**STEP 2: PARALLEL MULTI-PERSPECTIVE AUDIT**\n\n\u26a0\ufe0f **CRITICAL: Spawn ALL subagents SIMULTANEOUSLY, not sequentially.**\n\nDelegate to THREE subagents AT THE SAME TIME:\n\n**Subagent 1 - Context Researcher (Completeness Focus):**\n```\nPlease execute the 'Context Gathering Routine' workflow in audit mode.\n\nAudit Request:\nMISSION: Audit my context gathering for COMPLETENESS\n\nMY CONTEXT GATHERING:\n[Paste the contents of BUG_ULTRA_investigation.md]\n\nFOCUS: Completeness\n- Did I miss any critical files or areas?\n- Are there important components I didn't investigate?\n- What else should I have looked at?\n```\n\n**Subagent 2 - Context Researcher (Depth Focus):**\n```\nPlease execute the 'Context Gathering Routine' workflow in audit mode.\n\nAudit Request:\nMISSION: Audit my context gathering for DEPTH\n\nMY CONTEXT GATHERING:\n[Paste the contents of BUG_ULTRA_investigation.md]\n\nFOCUS: Depth\n- Did I go deep enough, or stay too surface-level?\n- Should I have read implementations instead of just signatures?\n- What areas need deeper investigation?\n```\n\n**Subagent 3 - Execution Simulator:**\n```\nPlease execute the 'Execution Simulation Routine' workflow.\n\nSimulation Request:\nMISSION: Trace the key execution paths for [feature/system]\n\nTARGET: [The feature/system from the bug report]\n\nCONTEXT:\n[Paste relevant sections from BUG_ULTRA_investigation.md]\n\nSCENARIOS:\n1. Happy path (normal operation)\n2. Error path (when bug occurs)\n\nDELIVERABLE: BUG_ULTRA_execution_traces.md\n```\n\n**STEP 3: SYNTHESIZE MULTI-PERSPECTIVE FEEDBACK**\n\nReview all three deliverables:\n1. Completeness audit: What did I miss?\n2. Depth audit: Where should I go deeper?\n3. Execution traces: What paths are relevant?\n\n**Synthesis Strategy:**\n- **Common concerns**: If 2+ subagents flag the same area, prioritize it\n- **Unique insights**: Each subagent may catch different gaps\n- **Conflicting advice**: If they disagree, investigate to understand why\n\n**STEP 4: ITERATE BASED ON SYNTHESIS**\n\nBased on the combined feedback, run the Context Gathering Routine again:\n- If completeness gaps: Expand target scope\n- If depth gaps: Increase depth level (depth=3)\n- If execution unclear: Focus on specific execution paths\n\n**FINALIZE YOUR SETUP:**\nUpdate BUG_ULTRA_investigation.md with:\n- All audit findings synthesized\n- Additional investigation you did\n- Your workspace location\n- Any early assumptions to verify later\n\n**Before Proceeding**: Did all three perspectives confirm your understanding is sufficient? If not, iterate until they do.",
      "agentRole": "You are an investigative coordinator, leveraging specialized researchers to build a comprehensive understanding before diving into analysis.",
      "requireConfirmation": false,
      "guidance": [
        "ROUTINE: Execute 'Context Gathering Routine' workflow first",
        "PARALLEL: Spawn all 3 subagents SIMULTANEOUSLY (not one-by-one)",
        "DIVERSITY: Each subagent has different focus (completeness, depth, execution)",
        "SYNTHESIS: Combine all perspectives, prioritize common concerns",
        "ITERATE: Run routine again if significant gaps found",
        "QUALITY GATE: Don't proceed until all perspectives are satisfied"
      ]
    },
    {
      "id": "phase-1a-plan",
      "title": "Phase 1A: Plan Your Investigation Approach",
      "prompt": "**PLAN HOW YOU'LL TRACK DOWN THIS BUG**\n\nYou're about to analyze the codebase. But first, think strategically about HOW you'll investigate.\n\n**Think Through**:\n\n1. **Where does execution start?**\n   - What triggers this bug? (API call, user action, test, scheduled job?)\n   - Where in the code does execution begin?\n\n2. **What's your investigation strategy?**\n   - Will you trace execution flow from entry to error?\n   - Will you start at the error and work backwards?\n   - Will you examine recent changes first?\n   - How will you identify the key points to investigate?\n\n3. **What could cause you to miss the real issue?**\n   - Focusing too narrowly on one area?\n   - Missing indirect causes or side effects?\n   - Assuming things work as documented?\n   - Not checking alternative execution paths?\n\n4. **What's your analysis plan?**\n   - List the sequence of investigations you'll do\n   - What will you look for at each step?\n   - How will you know when you understand enough?\n\n**OUTPUT**: Update BUG_ULTRA_investigation.md with \"Phase 1 Investigation Plan\" section:\n- Your investigation strategy\n- Sequence of steps you'll take\n- Key questions you need to answer\n- Risks you're watching out for\n\n**Self-Check**: Is your plan specific enough to follow? Does it account for the ways you might miss the real cause?",
      "agentRole": "You are a strategic investigator planning your approach. Think before you dive in.",
      "requireConfirmation": false,
      "guidance": [
        "STRATEGY: Think before you act - plan your investigation approach",
        "SCOPE: Consider both forward tracing (entry\u2192error) and backward tracing (error\u2192entry)",
        "RISKS: Identify ways you might miss the real cause",
        "OUTPUT: Document your plan in BUG_ULTRA_investigation.md"
      ]
    },
    {
      "id": "phase-1b-execute",
      "title": "Phase 1B: Execute Your Investigation",
      "prompt": "**CARRY OUT YOUR INVESTIGATION PLAN**\n\nNow execute the investigation strategy you designed.\n\n**Execute Your Plan**:\n- Follow the sequence of investigations you planned\n- Trace execution flow from entry point to error\n- Track how data flows and state changes\n- Read the actual code at key points\n- Note anything suspicious or unexpected\n- Adapt your plan if you discover new information\n\n**Document As You Go**:\nCreate BUG_ULTRA_execution_flow.md with:\n- **Entry Point**: Where execution begins\n- **Call Chain**: Step-by-step path from entry to error (with file:line)\n- **Data Flow**: How data transforms along the way\n- **State Changes**: What gets modified\n- **Suspicious Points**: Code that could be problematic\n- **Patterns**: How things normally work vs how they work in failing case\n\n**Self-Critique**:\n- Did you follow your plan or skip steps?\n- Did you actually trace the execution flow, or just read code?\n- What did you learn that surprised you?\n- What are you still uncertain about?\n- Did your plan work, or should you investigate differently?\n\n**Critical Reminder**: You're building understanding of what the code DOES. You don't have a diagnosis yet - that comes later after you form and test hypotheses.",
      "agentRole": "You are executing your investigation plan. Stay systematic and document what you find.",
      "requireConfirmation": false,
      "guidance": [
        "TOOLS: Use read_file, grep, codebase_search to trace execution",
        "DOCUMENTATION: Create BUG_ULTRA_execution_flow.md as you investigate",
        "CITATIONS: Include file:line references for everything",
        "DISCIPLINE: Follow your plan, don't jump to conclusions"
      ]
    },
    {
      "id": "phase-2a-plan",
      "title": "Phase 2A: Plan Your Hypothesis Development",
      "prompt": "**CRITICAL CHECKPOINT: IS THIS ACTUALLY A BUG?**\n\nBefore forming hypotheses about what's wrong, investigate the original intent.\n\n**Investigate Original Intent:**\n\n1. **Check git history:**\n   - Use git log/blame on relevant files\n   - Look for commit messages explaining this behavior\n   - When was this code written? By whom?\n\n2. **Search for documentation:**\n   - Comments explaining the behavior\n   - README or design docs\n   - ADRs (Architecture Decision Records)\n   - Issue/ticket history\n\n3. **Examine tests:**\n   - What behavior do tests validate?\n   - Do tests expect this behavior?\n   - Are there tests that would fail if you \"fixed\" this?\n\n4. **Consider constraints:**\n   - What requirements might explain this?\n   - What technical constraints could justify this?\n   - What trade-offs might have been made?\n\n**CRITICAL QUESTION**: Could this be working as designed, not a bug?\n\n---\n\n**PLAN HOW YOU'LL FORM HYPOTHESES**\n\nBased on your investigation, you'll now develop hypotheses about what's causing the bug.\n\n**Think Through**:\n\n1. **What patterns did you notice?**\n   - From your execution flow tracing, what stood out?\n   - What code seemed suspicious?\n   - What assumptions are baked into the code?\n\n2. **What types of causes should you consider?**\n   - Logic errors in the code?\n   - Data issues (wrong format, corruption, missing)?\n   - Timing or race conditions?\n   - Environment or configuration issues?\n   - Integration problems with dependencies?\n   - **Working as designed** (not actually a bug)?\n\n3. **How will you avoid anchoring on your first idea?**\n   - How many alternative hypotheses will you generate?\n   - How will you challenge your initial impressions?\n   - What evidence would contradict your leading theory?\n\n4. **What makes a good hypothesis?**\n   - Specific enough to test\n   - Explains all the symptoms\n   - Has clear evidence for/against\n   - Can be proven or disproven\n\n**OUTPUT**: Update BUG_ULTRA_investigation.md with \"Phase 2 Hypothesis Strategy\":\n- Results of your intent investigation\n- How you'll generate multiple hypotheses\n- What types of causes you'll consider (including \"not a bug\")\n- How you'll avoid confirmation bias\n- How you'll test your hypotheses\n\n**Self-Check**: Are you committed to generating multiple hypotheses, or are you already attached to one idea? Have you seriously considered that this might not be a bug?",
      "agentRole": "You are strategizing about hypothesis formation. Commit to staying open-minded.",
      "requireConfirmation": false,
      "guidance": [
        "INTENT: Check git history, comments, tests, docs for original intent",
        "QUESTION: Could this be working as designed?",
        "MINDSET: Commit to generating multiple hypotheses, not just one",
        "DIVERSITY: Consider different types of causes (including 'not a bug')",
        "BIAS: Plan how you'll avoid anchoring on your first idea",
        "OUTPUT: Document intent investigation and hypothesis strategy"
      ]
    },
    {
      "id": "phase-2b-execute",
      "title": "Phase 2B: Form Hypotheses (Ultra - Parallel Challenge)",
      "prompt": "**FORM MULTIPLE HYPOTHESES ABOUT THE BUG**\n\nNow generate your hypotheses following your strategy.\n\n**Generate Hypotheses**:\n\nFor each possible cause, create a hypothesis:\n\n**Hypothesis Template**:\n- **ID**: H1, H2, H3, etc.\n- **Statement**: \"The bug occurs because [specific cause]\"\n- **Evidence For**: What from your investigation supports this?\n- **Evidence Against**: What contradicts this or makes it unlikely?\n- **How to Test**: What evidence would prove/disprove this?\n- **Likelihood** (1-10): Based on current evidence\n\n**Generate 3-7 hypotheses**. Force yourself to consider alternatives even if one seems obvious.\n\n**DELEGATION OPPORTUNITY: Adversarial Challenge**\n\nOnce you have initial hypotheses, consider delegating to your Hypothesis Challenger subagent for rigorous critique.\n\n**HOW TO DELEGATE:**\n\n1. **Prepare the work package:**\n```\nMISSION: Challenge and stress-test my bug hypotheses\n\nHYPOTHESES: [Paste your 3-7 hypotheses from above]\n\nEVIDENCE:\n- BUG_ULTRA_execution_flow.md (file reference)\n- BUG_ULTRA_investigation.md (file reference)\n- [Any other evidence files]\n\nRIGOR: 3 (Deep - thorough adversarial review)\n\nDELIVERABLE:\nFor each hypothesis:\n- Strengths (what evidence supports it)\n- Weaknesses (gaps, contradictions, assumptions)\n- Alternative explanations (what else could cause this)\n- Verdict (Keep/Revise/Reject/Insufficient Evidence)\n- Recommendations (how to strengthen or what to test)\n```\n\n2. **Instruct the Hypothesis Challenger:**\n\nTell the subagent:\n```\nPlease execute the 'Hypothesis Challenge Routine' workflow at rigor=3 (Deep level).\n\nWork Package: [Paste the work package from above]\n```\n\n**AFTER DELEGATION:**\nReview the Hypothesis Challenger's critique and refine your hypotheses.\n\n**Prioritize**:\nRank by:\n1. Likelihood (evidence strength after challenge)\n2. Testability (can you validate it?)\n3. Completeness (explains all symptoms?)\n\n**Plan Validation**:\nFor top 3-5 hypotheses:\n- What instrumentation would prove/disprove each?\n- What tests should you run?\n- What experiments could distinguish between them?\n\n**OUTPUT**: Create BUG_ULTRA_hypotheses.md with all hypotheses, challenger feedback, rankings, and validation strategy.\n\n**\ud83d\udea8 CRITICAL - YOU ARE NOT DONE:**\n\nYou now have theories. You do NOT have proof.\n\nEven if H1 has 10/10 likelihood, it's based on reading code, not evidence from running code.\n\nYou MUST continue to Phase 3 (design instrumentation) and Phase 4 (collect evidence).\n\nThis is not optional. High confidence without evidence = educated guess, not diagnosis.\n\nCall workflow_next to continue.\n\n**PARALLEL ADVERSARIAL REVIEW**\n\n\u26a0\ufe0f **CRITICAL: Spawn BOTH subagents SIMULTANEOUSLY.**\n\nAfter documenting your hypotheses, delegate to TWO Hypothesis Challengers AT THE SAME TIME:\n\n**Challenger 1 - Moderate Rigor (rigor=3):**\n```\nPlease execute the 'Hypothesis Challenge Routine' workflow at rigor=3.\n\nChallenge Request:\nHYPOTHESES: [Paste your hypotheses from BUG_ULTRA_hypotheses.md]\nEVIDENCE: [Summarize the evidence for each]\nRIGOR: 3 (Thorough adversarial analysis)\n\nChallenge each hypothesis and find weaknesses.\n```\n\n**Challenger 2 - Maximum Rigor (rigor=5):**\n```\nPlease execute the 'Hypothesis Challenge Routine' workflow at rigor=5.\n\nChallenge Request:\nLEADING HYPOTHESIS: [Your most likely hypothesis]\nEVIDENCE: [The strongest evidence]\nRIGOR: 5 (Try to completely break this)\n\nTry to prove this hypothesis is WRONG. Find any way it could fail.\n```\n\n**SYNTHESIS:**\n- If Challenger 1 finds issues: Strengthen or revise hypotheses\n- If Challenger 2 breaks leading hypothesis: Reconsider alternatives\n- If both give green light: High confidence in your hypotheses\n\nUpdate BUG_ULTRA_hypotheses.md with challenge results and any revisions.",
      "agentRole": "You are forming competing hypotheses and subjecting them to rigorous challenge. Stay open to alternatives even if one seems obvious.",
      "requireConfirmation": false,
      "guidance": [
        "QUANTITY: Generate 3-7 hypotheses minimum, force alternatives",
        "STRUCTURE: Use the hypothesis template for consistency",
        "DELEGATION: Consider using hypothesis-challenger subagent for critique",
        "REMINDER: High confidence \u2260 proof. You still need evidence.",
        "PARALLEL: Spawn both Hypothesis Challengers SIMULTANEOUSLY",
        "DIVERSITY: Different rigor levels (3 and 5)",
        "SYNTHESIS: Integrate both challenge perspectives"
      ]
    },
    {
      "id": "phase-3a-plan",
      "title": "Phase 3A: Design Your Instrumentation Strategy",
      "prompt": "**PLAN HOW YOU'LL GATHER EVIDENCE**\n\nYou have hypotheses. Now design how you'll gather evidence to test them.\n\n**Think Through**:\n\n1. **What evidence would prove each hypothesis?**\n   - For H1, what specific data points would confirm it?\n   - For H2, what would you observe if it's correct?\n   - How can you distinguish between competing hypotheses?\n\n2. **Where should you add instrumentation?**\n   - What points in the execution flow are critical?\n   - Where could you observe the data/state you need?\n   - What's already being logged vs what do you need to add?\n\n3. **What's the right level of detail?**\n   - Too much logging = noise and hard to analyze\n   - Too little = gaps and missing evidence\n   - How will you balance this?\n\n4. **Can you use existing tests?**\n   - Are there tests you can enhance instead of adding new logging?\n   - Can you modify tests to expose the state you need?\n   - Should you write new targeted tests?\n\n**OUTPUT**: Update BUG_ULTRA_investigation.md with \"Phase 3 Instrumentation Plan\":\n- What evidence you need for each hypothesis\n- Where you'll add instrumentation (file:line)\n- What you'll log/observe at each point\n- Test scenarios you'll prepare\n- How you'll organize output to distinguish hypotheses\n\n**Self-Check**: Will this instrumentation actually give you the evidence you need? What might you miss?",
      "agentRole": "You are designing your evidence collection strategy. Think carefully about what you need to prove.",
      "requireConfirmation": false,
      "guidance": [
        "EVIDENCE: Define what would prove/disprove each hypothesis",
        "INSTRUMENTATION: Plan where to add logging/debugging",
        "BALANCE: Enough detail to distinguish hypotheses, not so much you drown in noise",
        "OUTPUT: Document your instrumentation plan"
      ]
    },
    {
      "id": "phase-3b-execute",
      "title": "Phase 3B: Implement Your Instrumentation",
      "prompt": "**ADD INSTRUMENTATION AND PREPARE TEST SCENARIOS**\n\nNow implement the instrumentation strategy you designed.\n\n**DELEGATION OPPORTUNITY: Execution Simulation**\n\nBefore adding instrumentation, consider simulating execution to predict outcomes and refine your strategy.\n\n**HOW TO DELEGATE:**\n\n1. **Prepare the work package:**\n```\nMISSION: Simulate execution paths for my top hypotheses\n\nHYPOTHESES: [Paste top 3-5 hypotheses]\n\nCONTEXT:\n- BUG_ULTRA_execution_flow.md (file reference)\n- BUG_ULTRA_hypotheses.md (file reference)\n- Key files: [List critical files from investigation]\n\nMODE: trace (Detailed execution path analysis)\n\nDELIVERABLE:\nFor each hypothesis:\n- Predicted execution path (step-by-step)\n- State changes at each step\n- Where instrumentation would be most revealing\n- Expected outputs if hypothesis is correct\n- Distinguishing characteristics between hypotheses\n```\n\n2. **Instruct the Execution Simulator:**\n\nTell the subagent:\n```\nPlease execute the 'Execution Simulation Routine' workflow in trace mode.\n\nWork Package: [Paste the work package from above]\n```\n\n**AFTER DELEGATION:**\nUse the simulation results to refine your instrumentation plan.\n\n**Implement**:\n- Add debug logging at the points identified by simulation\n- Enhance or create tests to expose necessary state\n- Add assertions to catch violations\n- Set up controlled experiments if needed\n- Label everything clearly ([H1], [H2], etc.)\n\n**Prepare Test Scenarios**:\n- Minimal reproduction case\n- Edge cases that might behave differently\n- Working scenarios for comparison\n- Variations that test specific hypotheses\n\n**OUTPUT**: Update BUG_ULTRA_investigation.md with:\n- List of instrumentation added (what/where/why)\n- Test scenarios prepared\n- Expected outcomes for each hypothesis (from simulation)\n- How you'll analyze results\n\n**Self-Critique**:\n- Did you add the instrumentation you planned?\n- Did you skip any because it seemed unnecessary?\n- Is your instrumentation labeled clearly?\n- Are your test scenarios sufficient?\n\n**Readiness Check**: If you run these tests, will you get the evidence you need to prove/disprove your hypotheses?",
      "agentRole": "You are implementing your evidence collection plan with precision, informed by execution simulation. Good instrumentation is the foundation of proof.",
      "requireConfirmation": false,
      "guidance": [
        "DELEGATION: Consider using execution-simulator subagent first",
        "TOOLS: Use edit tools to add instrumentation",
        "LABELING: Mark instrumentation clearly ([H1], [H2], etc.)",
        "TESTS: Prepare test scenarios before running"
      ]
    },
    {
      "id": "phase-4-execute",
      "title": "Phase 4: Collect Evidence",
      "prompt": "**RUN INSTRUMENTED CODE AND COLLECT EVIDENCE**\n\nNow run your test scenarios and collect the evidence.\n\n**Execute**:\n- Run minimal reproduction case\n- Run edge cases and variations\n- Run working scenarios for comparison\n- Capture all output (logs, errors, test results)\n\n**Organize Evidence**:\nFor each hypothesis, create BUG_ULTRA_evidence_H1.md, BUG_ULTRA_evidence_H2.md, etc.:\n- What did the instrumentation reveal?\n- Does behavior match predictions?\n- What unexpected findings emerged?\n- Quality rating (1-10): How strong is this evidence?\n\n**Analyze Patterns**:\n- Which hypotheses are supported by evidence?\n- Which are contradicted?\n- Are there patterns you didn't predict?\n- Do you need different instrumentation?\n- Should you form new hypotheses?\n\n**Update Hypotheses**:\nUpdate BUG_ULTRA_hypotheses.md with:\n- Evidence collected for each\n- New likelihood scores based on evidence\n- Evidence quality ratings\n- New insights or remaining questions\n\n**Decision Point**:\n- Strong evidence (8+/10) for one hypothesis? \u2192 Proceed to validation\n- Need more instrumentation? \u2192 Go back and add it\n- Need to revise hypotheses? \u2192 Update them\n\nBut you're not done until you have strong evidence. Keep investigating.",
      "agentRole": "You are collecting evidence systematically. Let the data guide you, not your assumptions.",
      "requireConfirmation": false,
      "guidance": [
        "EXECUTION: Run your test scenarios and capture all output",
        "ORGANIZATION: Create BUG_ULTRA_evidence_H1.md, BUG_ULTRA_evidence_H2.md, etc.",
        "ANALYSIS: Compare actual behavior to predictions",
        "ITERATION: If evidence is weak, add more instrumentation"
      ]
    },
    {
      "id": "phase-5-validate",
      "title": "Phase 5: Validate Conclusion (Ultra - Parallel Multi-Perspective)",
      "prompt": "**RIGOROUSLY VALIDATE YOUR FINDING**\n\nYou have a leading hypothesis with evidence. Now be your harshest critic.\n\n**State Your Conclusion**:\n- What hypothesis has the strongest evidence?\n- What's your confidence (1-10)?\n- What evidence supports it?\n\n**DELEGATION OPPORTUNITY: Adversarial Validation**\n\nYour conclusion needs rigorous challenge. Delegate to your Hypothesis Challenger for maximum-rigor adversarial review.\n\n**HOW TO DELEGATE:**\n\n1. **Prepare the work package:**\n```\nMISSION: Rigorously validate my bug diagnosis\n\nHYPOTHESES:\n- Leading hypothesis: [Your conclusion]\n- Alternatives considered: [List other hypotheses you ruled out]\n\nEVIDENCE:\n- BUG_ULTRA_evidence_H*.md files (file references)\n- BUG_ULTRA_hypotheses.md (file reference)\n- BUG_ULTRA_investigation.md (file reference)\n- Instrumentation output/logs (file references or inline)\n\nRIGOR: 5 (Maximum - exhaustive adversarial review)\n\nDELIVERABLE:\n- Strengths of leading hypothesis\n- Weaknesses and gaps\n- Alternative explanations not yet ruled out\n- Contradicting evidence\n- Edge cases that might break the explanation\n- Verdict with confidence assessment\n- Recommendations for additional validation\n```\n\n2. **Instruct the Hypothesis Challenger:**\n\nTell the subagent:\n```\nPlease execute the 'Hypothesis Challenge Routine' workflow at rigor=5 (Maximum level).\n\nWork Package: [Paste the work package from above]\n```\n\n**AFTER DELEGATION:**\nReview the Hypothesis Challenger's adversarial critique.\n\n**If confidence < 9/10**:\n- What specific test would raise confidence?\n- What alternative should you rule out?\n- What additional evidence do you need?\n- Go collect that evidence\n\n**Final Assessment**:\nAnswer these YES/NO:\n- Does this explain all observed symptoms?\n- Have you ruled out major alternatives?\n- Can you reproduce the bug based on this understanding?\n- Would you stake your reputation on this diagnosis?\n- Is there any contradicting evidence?\n- Did the adversarial review strengthen or weaken your confidence?\n\n**OUTPUT**: BUG_ULTRA_validation.md with:\n- Leading hypothesis and evidence\n- Alternatives considered and ruled out\n- Adversarial review findings (from Hypothesis Challenger)\n- Final confidence score\n- Remaining uncertainties\n\n**Threshold**: 9+/10 confidence with strong evidence to proceed. If not, keep investigating.\n\n**PARALLEL MULTI-PERSPECTIVE VALIDATION**\n\n\u26a0\ufe0f **CRITICAL: Spawn ALL THREE subagents SIMULTANEOUSLY.**\n\nBefore committing to your conclusion, get three independent perspectives AT THE SAME TIME:\n\n**Validator 1 - Hypothesis Challenger (rigor=5):**\n```\nPlease execute the 'Hypothesis Challenge Routine' workflow at rigor=5.\n\nChallenge Request:\nCONCLUSION: [Your final conclusion about the bug]\nEVIDENCE: [All evidence supporting this conclusion]\nRIGOR: 5 (Maximum adversarial review)\n\nTry to prove this conclusion is WRONG. Find any holes in the logic.\n```\n\n**Validator 2 - Execution Simulator:**\n```\nPlease execute the 'Execution Simulation Routine' workflow.\n\nSimulation Request:\nMISSION: Simulate the proposed fix\n\nPROPOSED FIX: [Your fix from BUG_ULTRA_validation.md]\nCONTEXT: [Relevant code context]\n\nSCENARIOS:\n1. Does the fix resolve the bug?\n2. Does the fix introduce new issues?\n3. Are there edge cases the fix doesn't handle?\n\nDELIVERABLE: BUG_ULTRA_fix_simulation.md\n```\n\n**Validator 3 - Plan Analyzer:**\n```\nPlease execute the 'Plan Analysis Routine' workflow.\n\nAnalysis Request:\nPLAN: [Your fix plan from BUG_ULTRA_validation.md]\n\nANALYZE:\n- Is the plan complete?\n- Are there missing steps?\n- Are there risks or gotchas?\n- Does it follow best practices?\n\nDELIVERABLE: BUG_ULTRA_plan_analysis.md\n```\n\n**FINAL SYNTHESIS - TRIPLE VALIDATION GATE:**\n\nReview all three perspectives:\n1. Hypothesis Challenger: Can they break your conclusion?\n2. Execution Simulator: Does the fix work in simulation?\n3. Plan Analyzer: Is the fix plan sound?\n\n**Quality Gate:**\n- \u2705 ALL THREE give green light \u2192 Proceed with confidence\n- \u26a0\ufe0f ONE raises concerns \u2192 Investigate and address\n- \ud83d\uded1 TWO+ raise concerns \u2192 Return to Phase 2 (re-form hypotheses)\n\n**ONLY PROCEED if you have triple validation.**\n\nUpdate BUG_ULTRA_validation.md with all validation results.",
      "agentRole": "You are validating your conclusion with maximum rigor, leveraging adversarial challenge to ensure you haven't missed anything.",
      "requireConfirmation": false,
      "guidance": [
        "CONSTRAINT: Validate your conclusion, but do NOT implement the fix",
        "DELEGATION: Use hypothesis-challenger subagent at maximum rigor",
        "THRESHOLD: Need 9+/10 confidence to proceed",
        "ALTERNATIVES: Ensure you've ruled out major competing explanations",
        "HONESTY: If confidence is low, go back and gather more evidence",
        "PARALLEL: Spawn all 3 validators SIMULTANEOUSLY",
        "DIVERSITY: Three different cognitive modes (adversarial, simulation, planning)",
        "TRIPLE GATE: ALL THREE must validate before proceeding",
        "ITERATE: If 2+ raise concerns, return to Phase 2"
      ]
    },
    {
      "id": "phase-6-writeup",
      "title": "Phase 6: Prove Your Case",
      "prompt": "**DOCUMENT YOUR INVESTIGATION - PROVE YOU FOUND THE TRUE SOURCE**\n\nYou've found the true source of the bug. Now prove it to others.\n\n**Your Task**: Create a diagnostic writeup that proves your case.\n\n**Structure**:\n\n**1. EXECUTIVE SUMMARY** (3-5 sentences)\n- What's the bug?\n- What's the true cause?\n- How confident are you? (should be 9-10/10)\n- What's the impact?\n\n**2. THE TRUE SOURCE** (detailed)\n- Explain the root cause\n- Why this causes the observed symptoms\n- Code locations (file:line)\n- Relevant code snippets\n\n**3. THE PROOF** (your evidence)\n- Key evidence that proves this diagnosis\n- How you collected it (instrumentation, tests)\n- Evidence quality and sources\n- Why alternative explanations don't fit\n\n**4. HOW TO REPRODUCE**\n- Minimal steps to reproduce\n- What to observe that confirms the diagnosis\n- Conditions required\n\n**5. YOUR INVESTIGATION**\n- What you analyzed\n- Hypotheses you tested\n- How you arrived at the conclusion\n- Key turning points\n\n**6. FIXING IT**\n- Suggested approach (conceptual)\n- Risks to consider\n- How to verify the fix\n- Tests that should be added\n\n**7. UNCERTAINTIES** (if any)\n- What you're still unsure about\n- Edge cases needing more investigation\n\n**OUTPUT**: BUG_ULTRA_diagnostic.md\n\n**Quality Check**:\n- Could someone fix this bug confidently from your writeup?\n- Have you proven your case with evidence?\n- Is it clear WHY this is the true source, not just a symptom?\n\n**Mission Complete**: You've tracked down the true source and proven it. Well done.",
      "agentRole": "You are documenting your successful investigation. You found the truth - now prove it to others.",
      "requireConfirmation": false,
      "guidance": [
        "AUDIENCE: Write for someone who will fix the bug",
        "PROOF: Include evidence, not just assertions",
        "REPRODUCTION: Provide clear steps to reproduce",
        "OUTPUT: Create BUG_ULTRA_diagnostic.md"
      ]
    },
    {
      "id": "phase-6-handoff",
      "title": "Phase 6: Investigation Complete - Handoff",
      "prompt": "**INVESTIGATION COMPLETE - DO NOT IMPLEMENT THE FIX**\n\n\u26a0\ufe0f **CRITICAL BOUNDARY: This workflow is for INVESTIGATION ONLY.**\n\nYour job was to:\n- \u2705 Understand the bug\n- \u2705 Trace execution flow\n- \u2705 Form and test hypotheses\n- \u2705 Identify the root cause\n- \u2705 Validate your conclusion\n\nYour job is NOT to:\n- \u274c Write the fix\n- \u274c Modify any code\n- \u274c Create a PR\n- \u274c Implement the solution\n\n**HANDOFF DELIVERABLE:**\n\nCreate a final handoff document that someone else can use to implement the fix:\n\n**File: BUG_[VERSION]_handoff.md**\n\n```markdown\n# Bug Investigation Handoff\n\n## Executive Summary\n- **Bug**: [One sentence description]\n- **Root Cause**: [What's actually wrong]\n- **Confidence**: [High/Medium/Low based on validation]\n\n## Investigation Files\n- Investigation context: BUG_[VERSION]_investigation.md\n- Execution flow: BUG_[VERSION]_execution_flow.md\n- Hypotheses: BUG_[VERSION]_hypotheses.md\n- Validation: BUG_[VERSION]_validation.md\n\n## Root Cause Analysis\n[Detailed explanation of what's wrong and why]\n\n## Recommended Fix\n[High-level description of what needs to change]\n\n**Files to modify:**\n- [file:line] - [what needs to change]\n- [file:line] - [what needs to change]\n\n**Why this fixes it:**\n[Explain how the fix addresses the root cause]\n\n## Edge Cases & Risks\n[Things to watch out for when implementing]\n\n## Testing Recommendations\n[How to verify the fix works]\n\n## Next Steps\n1. Review this investigation\n2. Implement the recommended fix\n3. Test thoroughly\n4. Submit for code review\n```\n\n**OUTPUT**: BUG_[VERSION]_handoff.md with complete investigation summary\n\n**Before Finishing**: Have you clearly documented the root cause and recommended fix so someone else can implement it?",
      "agentRole": "You are completing your investigation and handing off to an implementation team. Document everything clearly.",
      "requireConfirmation": false,
      "guidance": [
        "BOUNDARY: Do NOT implement the fix yourself",
        "HANDOFF: Create clear documentation for implementation team",
        "COMPLETENESS: Include all investigation artifacts",
        "CLARITY: Someone else should be able to implement from your handoff"
      ]
    }
  ]
}